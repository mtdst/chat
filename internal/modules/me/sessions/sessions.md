### Сессии

#### Создание по паролю

```http
POST https://api.url/me/sessions HTTP/1.1
```

*Создаёт новую сессию по паролю, записывает её идентификатор в Cookie и возвращает CSRF-токен*

##### Запрос

- Требует авторизации: нет (пользователь должен быть не авторизован)

Нагрузка (тело)
| Имя      | Тип    | Описание       |
| -------- | ------ | -------------- |
| phone    | int    | Номер телефона |
| password | string | Пароль         |

##### Результат

- Возможна фильтрация: нет
- Возможен выбор полей: нет

Возвращаемые поля
| Имя   | Тип    | Описание   |
| ----- | ------ | ---------- |
| token | string | CSRF-токен |

Пример ответа в случае успеха

*залоговок:*
```http
HTTP/1.1 200 OK
Set-Cookie: session=21d6f40cfb511982e4424e0e250a9557; Path=/; Expires=Sun, 01 Jan 2020 00:01:02 GMT; HttpOnly; Secure
```

*тело:*
```json
{
  "token": "41ca36dffcdc5e5a32bbdbd5d585b12d"
}
```

##### Ошибки
- `23002` - Пользователь уже авторизован
- `23004` - Ошибка чтения тела запроса
- `23005` - Ошибка парсинга тела запроса
- `23006` - Ошибка определения IP-адреса пользователя
- `23007` - Ошибка выполнения SQL-запроса для создания сессии
- `23008` - Ошибка компиляции w3sql-запроса для создания SMS-кода
- `23009` - Ошибка сканирования результатов SQL-запроса создания SMS-кода
- `23010` - Не передан номер телефона
- `23011` - Ошибка чтения header запроса
- `23012` - Пользователь заблокирован
- `23013` - Таймаут ожидания для отправки SMS не истёк
- `23014` - Ошибка отправки SMS
- `23015` - Не передан пароль
- `23016` - Некорректный номер телефона
- `23017` - Ошибка получения мобильного контекста

[К содержанию](#содержание)

#### Создание по SMS-коду

```http
POST https://api.url/me/sessions HTTP/1.1
```

*Создаёт новую сессию по SMS-коду, записывает её идентификатор в Cookie и возвращает CSRF-токен*

Данная операция доступна для устройств на Android и IOS и выполняется в два шага:
1. Отправка номера телефона, инициирующая отправку кода подтверждения на него
2. Отправка номера телефона и кода подтверждения

##### Запрос

- Требует авторизации: нет (пользователь должен быть не авторизован)
- Требует заголовок origin, со значением, соответствующим мобильному приложению

Нагрузка (тело)
| Имя      | Тип    | Описание          |
| -------- | ------ | ----------------- |
| phone    | int    | Номер телефона    |
| code     | string | Код подтверждения |

##### Результат при генерации кода

- Возможна фильтрация: нет
- Возможен выбор полей: нет

Возвращаемые поля
| Имя     | Тип  | Описание                                                               |
| ---     | ---- | ---------------------------------------------------------------------- |
| timeout | ?int | Количество секунд до возможности повторной отправки кода подтверждения |

Пример ответа в случае успеха

*тело:*
```json
{
  "timeout": 30
}
```

##### Результат при создании сессии

- Возможна фильтрация: нет
- Возможен выбор полей: нет

Возвращаемые поля
| Имя   | Тип    | Описание   |
| ----- | ------ | ---------- |
| token | string | CSRF-токен |

Пример ответа в случае успеха

*залоговок:*
```http
HTTP/1.1 200 OK
Set-Cookie: session=21d6f40cfb511982e4424e0e250a9557; Path=/; Expires=Sun, 01 Jan 2020 00:01:02 GMT; HttpOnly; Secure
```

*тело:*
```json
{
  "token": "190ac3f5d64de10588f09e248c65467c"
}
```

[К содержанию](#содержание)

#### Обновление

```http
PUT https://api.url/me/sessions HTTP/1.1
```

*Обновляет и возвращает CSRF-токен*

##### Запрос

- Требует авторизации: да

##### Результат

- Возможна фильтрация: нет
- Возможен выбор полей: нет

Возвращаемые поля
| Имя   | Тип    | Описание   |
| ----- | ------ | ---------- |
| token | string | CSRF-токен |

Пример ответа в случае успеха

*тело:*
```json
{
  "token": "41ca36dffcdc5e5a32bbdbd5d585b12d"
}
```

##### Ошибки
- `23001` - Ошибка авторизации
- `23003` - Ошибка открытия соединения с БД
- `23006` - Ошибка определения IP-адреса пользователя
- `23007` - Ошибка выполнения SQL-запроса для обновления сессии

[К содержанию](#содержание)


#### Удаление

```http
DELETE https://api.url/me/sessions HTTP/1.1
```

*Удаляет сессию и CSRF-токен*

##### Запрос

- Требует авторизации: да

##### Результат

- Возможна фильтрация: нет
- Возможен выбор полей: нет

Пример ответа в случае успеха

*залоговок:*
```http
HTTP/1.1 200 OK
Set-Cookie: session=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; HttpOnly; Secure
```

##### Ошибки
- `23001` - Ошибка авторизации
- `23003` - Ошибка открытия соединения с БД
- `23007` - Ошибка выполнения SQL-запроса для удаления сессии

[К содержанию](#содержание)